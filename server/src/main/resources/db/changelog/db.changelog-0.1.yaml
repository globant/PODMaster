---
databaseChangeLog:
  -
    changeSet:
      id: 1
      author: andres.postiglioni
      changes:
        -
          createTable:
            tableName: dashboard
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: locked
                  type: BOOLEAN
                  constraints:
                    nullable: false
              -
                column:
                  name: type
                  type: INTEGER
                  constraints:
                    nullable: false
        -
          createTable:
            tableName: widget
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: title
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: view_name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: height
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: width
                  type: INTEGER
                  constraints:
                    nullable: false
        -
          createTable:
            tableName: dashboard_widget
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: collapsed
                  type: BOOLEAN
                  constraints:
                    nullable: false
              -
                column:
                  name: dashboard_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: dashboard_widget_dashboard_fk
                    nullable: false
                    refrences: dashboard
              -
                column:
                  name: widget_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: dashboard_widget_widget_fk
                    nullable: false
                    references: widget
        -
          createTable:
            tableName: organization
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: description
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
        -
          createTable:
            tableName: product
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: description
                  type: VARCHAR(255)
                  constraints:
                    nullable: true

              -
                column:
                  name: organization_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: product_organization_fk
                    nullable: false
                    references: organization
        -
          createTable:
            tableName: project
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: description
                  type: VARCHAR(255)
                  constraints:
                    nullable: true

              -
                column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: project_product_fk
                    nullable: false
                    references: product
        -
          createTable:
            tableName: snapshot
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: creation_date
                  type: TIMESTAMP
                  constraints:
                    nullable: true
              -
                column:
                  name: product_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: snapshot_product_fk
                    nullable: false
                    references: product
        -
           createTable:
            tableName: release
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: number
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: creation_date
                  type: TIMESTAMP
                  constraints:
                    nullable: true

              -
                column:
                  name: project_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: project_release_fk
                    nullable: false
                    references: project
              -
                column:
                  name: snapshot_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: project_snapshot_fk
                    nullable: false
                    references: snapshot
        -
           createTable:
            tableName: sprint
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: number
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: start_date
                  type: TIMESTAMP
                  constraints:
                    nullable: true
              -
                column:
                  name: end_date
                  type: TIMESTAMP
                  constraints:
                    nullable: true
              -
                column:
                  name: release_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: sprint_release_fk
                    nullable: false
                    references: release
        -
           createTable:
            tableName: pod
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true

              -
                column:
                  name: sprint_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: pod_sprint_fk
                    nullable: true
                    references: sprint
        -
           createTable:
            tableName: pod_member
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: first_name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: last_name
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: email
                  type: VARCHAR(255)
                  constraints:
                    nullable: true
              -
                column:
                  name: pod_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: member_pod_pod_fk
                    nullable: true
                    references: pod
        -
           createTable:
            tableName: task
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: name
                  type: VARCHAR(100)
                  constraints:
                    nullable: true
              -
                column:
                  name: accuracy
                  type: FLOAT
                  constraints:
                    nullable: false
              -
                column:
                  name: actual
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: effort
                  type: FLOAT
                  constraints:
                    nullable: false
              -
                column:
                  name: estimated
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: remaining
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: priority
                  type: INTEGER
                  constraints:
                    nullable: true
              -
                column:
                  name: severity
                  type: INTEGER
                  constraints:
                    nullable: true
              -
                column:
                  name: created_date
                  type: timestamp
                  constraints:
                    nullable: true
              -
                column:
                  name: status
                  type: INTEGER
                  constraints:
                    nullable: true
              -
                column:
                  name: type
                  type: INTEGER
                  constraints:
                    nullable: true
              -
                column:
                  name: owner_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: owner_pod_member_fk
                    nullable: true
                    references: pod_member
              -
                column:
                  name: parent_task_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: parent_task_task_fk
                    nullable: true
                    references: task
              -
                column:
                  name: release_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: parent_task_release_fk
                    nullable: true
                    references: release
              -
               column:
                  name: sprint_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: parent_task_sprint_fk
                    nullable: true
                    references: sprint
        -
           createTable:
            tableName: sprint_pod_metric
            columns:
              -
                column:
                  name: id
                  type: BIGINT
                  autoIncrement: true
                  constraints:
                    primaryKey: true
              -
                column:
                  name: version
                  type: INTEGER
                  constraints:
                    nullable: false
              -
                column:
                  name: accepted_story_points
                  type: INTEGER
                  constraints:
                    primaryKey: true
              -
                column:
                  name: pod_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: sprint_pod_metric_pod_fk
                    nullable: false
                    references: pod
              -
               column:
                  name: sprint_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: sprint_pod_metric_sprint_fk
                    nullable: false
                    references: sprint
        -
          createTable:
            tableName: snapshot_sprint_pod_metrics
            columns:
              -
                column:
                  name: snapshot_id
                  type: BIGINT
                  constraints:
                    foreignKeyName: snapshot_sprint_pod_metrics_snapshot_fk
                    nullable: false
                    references: snapshot
              -
                column:
                  name: sprint_pod_metrics_id
                  type: BIGINT
                  #### TODO: I don't understand why enabling this constraint fails
                  # constraints:
                  #   foreignKeyName: snapshot_sprint_pod_metrics_sprint_pod_metric_fk
                  #   nullable: false
                  #   references: sprint_pod_metric
        -
          addPrimaryKey:
            tableName: snapshot_sprint_pod_metrics
            columnNames: snapshot_id, sprint_pod_metrics_id
            constraintName: snapshot_sprint_pod_metrics_pk
